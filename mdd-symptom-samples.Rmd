---
title: GenomicSEM of MDD symptoms sample counts
author: Mark Adams, Bradley Jermy, Jackson Thorp, Andrew Grotzinger, Michel Nivard 
output:
  github_document
---

Make table of counts of sypmtom presence/absence used in final analyses

```{r}

library(readxl)
library(readr)
library(dplyr)
library(tidyr)
library(stringr)

```

File for aligning sumstats filenames to cohort/symptom
```{r}

cohort_alignment <- read_tsv('meta/cohort_alignment.txt')

```

List of `basic.xls` files from Ricopili with sample counts

```{r}

basic_xls_list <- list.files('meta/distribution', pattern='basic.*.xls', full.names=TRUE)

basics <- bind_rows(lapply(basic_xls_list, read_excel)) %>%
filter(Dataset != 'SUM')

```

Merge and reformat

```{r}

basics_aligned <- 
cohort_alignment %>%
filter(!reference %in% c('MDD3', 'MDD4')) %>%
mutate(Dataset=str_replace(str_remove(filename, pattern='daner_'), 'gz', 'aligned.gz')) %>%
left_join(basics, by='Dataset') 

presence_absence <- basics_aligned %>% str_glue_data("{N_cases}:{N_controls}")

basics_aligned %>%
mutate(PresenceAbsence=as.character(presence_absence)) %>%
select(cohort, reference, PresenceAbsence) %>%
pivot_wider(names_from=cohort, values_from=PresenceAbsence)

basics_aligned %>%
mutate(sample=if_else(cohort %in% c('AGDS', 'PGC'), true='enriched', false='unselected')) %>%
group_by(sample, reference) %>%
summarise(N_cases=sum(N_cases), N_controls=sum(N_controls)) %>%
group_by(sample) %>%
summarise(minCa=min(N_cases, na.rm=T), maxCa=max(N_cases, na.rm=T), minCo=min(N_controls, na.rm=T), maxCo=max(N_controls, na.rm=T))

```
